generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Client {
  id        Int    @id @default(autoincrement())
  firstName String
  lastName  String
  idNum     Int    @unique

  Sale        Sale[]
  createdBy   Agnt   @relation(fields: [createdById], references: [id])
  createdById Int

  name    String? @default(dbgenerated())
  details String? @default(dbgenerated())
}

enum Role {
  AGNT
  OFFICE
  MNGR
  ADMIN
}

model Agnt {
  id        Int      @id @default(autoincrement())
  firstName String
  lastName  String?
  email     String   @unique
  phone     String?  @unique
  role      Role     @default(AGNT)
  verified  Boolean? @default(false)

  gglSub  String?
  gglName String?
  picture String?

  agntSales  Sale[] @relation("agnt")
  agnt2Sales Sale[] @relation("agnt2")

  createdClients Client[]
  createdSales   Sale[]

  name String? @default(dbgenerated())

  @@index([email])
}

model Sale {
  id Int @id @default(autoincrement())

  agntId     Int
  agnt2Id    Int?
  agntShare  Int    @default(100)
  agnt2Share Int?   @default(0)
  agntPay    Float
  agnt2Pay   Float? @default(0)

  offrDt   DateTime
  clientId Int

  company   String
  branch    String
  prdct     String
  prdctType String
  pay       Float
  status    String

  saleDt DateTime?
  action String?   @default("מכירה")

  client    Client   @relation(fields: [clientId], references: [id])
  agnt2     Agnt?    @relation(fields: [agnt2Id], references: [id], name: "agnt2")
  agnt      Agnt     @relation(fields: [agntId], references: [id], name: "agnt")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  total      Float? @default(0)
  agntTotal  Float? @default(0)
  agnt2Total Float? @default(0)

  createdBy   Agnt @relation(fields: [createdById], references: [id])
  createdById Int
}

// תאריך שליחת הצעה
// שם משפחה
// שם פרטי
// ת.ז
// סטטוס
// פעולה
// חברה
// ענף
// מוצר
// תאריך הפקה
// סוכן
// פרמיה חודשית
// פרמיה חד פעמית
// הפקדה חודשית
// הפקדה חדשה
// סכום צבירה לניוד
